version: '3.8'

services:
  minecraft:
    build:
      context: ./docker
      dockerfile: Dockerfile
    container_name: minecraft-server
    restart: unless-stopped

    # Mount current directory as server root
    volumes:
      - .:/server

    # Expose Minecraft ports
    ports:
      - "25565:25565"  # Minecraft server port
      - "25575:25575"  # RCON port (optional)

    # Environment variables
    environment:
      - TZ=UTC
      # Optional: Override automatic RAM detection
      # Uncomment to manually set heap size (in GB, without 'G' suffix)
      # - MEMORY_GB=6

    # Resource limits (adjust based on your system)
    # The container will auto-detect available RAM and leave overhead for OS
    # Set these limits based on your host's available memory
    deploy:
      resources:
        limits:
          memory: 8G  # Maximum RAM container can use
        reservations:
          memory: 6G  # Minimum RAM to reserve

    # stdin_open and tty for interactive console (optional)
    stdin_open: true
    tty: true

    # Healthcheck to monitor server status
    healthcheck:
      test: ["CMD-SHELL", "nc -z localhost 25565 || exit 1"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 120s
